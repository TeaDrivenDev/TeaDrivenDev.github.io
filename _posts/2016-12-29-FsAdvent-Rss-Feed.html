---
layout: page
title: Feeding On F#
---

<p><em>This article is an entry in the <a href="https://sergeytihon.wordpress.com/2016/10/23/f-advent-calendar-in-english-2016/">2016 F# Advent Calendar in English</a>.</em></p>

<h3>Vorgepl√§nkel</h3>

<p>First, I need to apologize for being so late with my contribution. I had actually booked a slot on December 20th, but my originally chosen topic turned out to be a very bad fit for a written article (I'd like to do that as a video at some point, though), so I had to start over with something else, which also proved very difficult to write for some reason, but here we go....</p>

<p>Chances are that you've come to this article from the 2016 F# Advent Calendar overview on Sergey Tihon's blog, where the full schedule is presented in a table showing the already written articles as well as the dates and authors for the remaining ones, so you get a full overview of the whole event.</p>

<p>One thing that this doesn't facilitate (as inherent in the medium) is keeping track of which articles you have or haven't read. What would be nice for that is an RSS feed, but we don't have that. We have all the information that we need, though, to build one ourselves - using F#, of course.</p>

<p>This will be a rather low-tech solution - we run a script that generates the XML file for the RSS feed, and then we put that somewhere on the Internet. That means there is some manual work involved once a day or so, but that way we only need somewhere to put a static file (I'm going to use GitHub Pages). This manual step can be eliminated if there's a place available to run a small webservice that checks the overview a few times a day and regenerates the feed on the server as needed.</p>

<h3>Reading</h3>

<p>We will use the HTML type provider from FSharp.Data to deal with the HTML. So we add the <code>FSharp.Data</code> package with Paket, reference the DLL in a new <code>.fsx</code> script file and create our <code>Page</code> type from the type provider.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">@&quot;..\packages\FSharp.Data\lib\net40\FSharp.Data.dll&quot;</span>

<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Data</span>

[&lt;<span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">OverviewUrl</span> <span class="o">=</span> <span class="s">@&quot;https://sergeytihon.wordpress.com/2016/10/23/f-advent-calendar-in-english-2016/&quot;</span>

<span class="k">type</span> <span class="i">Page</span> <span class="o">=</span> <span class="i">HtmlProvider</span><span class="o">&lt;</span><span class="i">OverviewUrl</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>Note that this does not constrain us to processing that one specific page. As long as the structure is what we expect, we can still pass in a different page later.</p>

<p>If we look at the HTML for a single post, that is a single row in the table, we find this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;</span><span class="i">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="i">Dec</span> <span class="n">15</span> (<span class="i">Thu</span>)<span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com/ReedCopsey/status/790203670637912064&quot;</span><span class="o">&gt;</span><span class="i">Reed</span> <span class="i">Copsey</span>, <span class="i">Jr</span><span class="o">.</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;http://reedcopsey.com/2016/12/15/christmas-trees-in-wpf-2016-edition/&quot;</span><span class="o">&gt;</span><span class="i">Christmas</span> <span class="i">Trees</span> <span class="k">in</span> <span class="i">WPF</span>, <span class="n">2016</span> <span class="i">Edition</span> <span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">tr</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>What we need from this is the date, the author's name, the post title and the post URL, all of which are easy enough to obtain. We'll keep them in this small F# record:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Entry</span> <span class="o">=</span> { <span class="i">Date</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">string</span>; <span class="i">Author</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">string</span>; <span class="i">Title</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">string</span>; <span class="i">Url</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">string</span> }
</code></pre></td>
</tr>
</table>

<p>However, before we start implementing this, we'll have a look at a special case from 2015:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;</span><span class="i">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span> <span class="i">Dec</span> <span class="n">05</span> (<span class="i">Saturday</span>)<span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com/ScottWlaschin/status/658388060032401412&quot;</span><span class="o">&gt;</span><span class="i">Scott</span> <span class="i">Wlaschin</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;http://fsharpforfunandprofit.com/posts/13-ways-of-looking-at-a-turtle/&quot;</span><span class="o">&gt;</span><span class="i">Thirteen</span> <span class="i">ways</span> <span class="k">of</span> <span class="i">looking</span> <span class="i">at</span> <span class="i">a</span> <span class="i">turtle</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">br</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;http://fsharpforfunandprofit.com/posts/13-ways-of-looking-at-a-turtle-2/&quot;</span><span class="o">&gt;</span><span class="i">Thirteen</span> <span class="i">ways</span> <span class="k">of</span> <span class="i">looking</span> <span class="i">at</span> <span class="i">a</span> <span class="i">turtle</span> (<span class="i">part</span> <span class="n">2</span>)<span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">br</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;http://fsharpforfunandprofit.com/posts/13-ways-of-looking-at-a-turtle-3/&quot;</span><span class="o">&gt;</span><span class="i">Thirteen</span> <span class="i">ways</span> <span class="k">of</span> <span class="i">looking</span> <span class="i">at</span> <span class="i">a</span> <span class="i">turtle</span> <span class="o">&amp;</span>#<span class="n">8211</span>; <span class="i">addendum</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">tr</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>Scott had so much content (as usual, one might say) that a single post would have gotten far, far too long, so he published several installments, all of which are listed for his one calendar entry. The proper way to handle that in our feed is probably creating an entry for each installment, so we need to be able to extract all the links and then treat them as if they were separate rows.</p>

<p>There are also rows in the table that we want to ignore
    - the header row
    - entry rows without actual links to articles, either because they're simply in the future, and the articles don't exist yet, or because they contain a "coming soon" notice, like the one for this post at the time of writing</p>

<p>If we look at a row, it's always a <code>&lt;tr&gt;</code> node containing three <code>&lt;td&gt;</code> nodes, the first of which is the date as simple text, the second the author's name in a link to the tweet or message announcing their participation, and the third contains the article links as <code>&lt;a&gt;</code> tags, if there are any.</p>

<p>A delay notice in the third column starts with a <code>&lt;span&gt;</code> tag to change the text color:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;</span><span class="i">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="i">Dec</span> <span class="n">20</span> (<span class="i">Tue</span>)<span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com/TeaDrivenDev/status/790270967356555268&quot;</span><span class="o">&gt;</span><span class="i">–¢—ç</span> <span class="i">–¥—Ä—ç–≤—ç—Ç</span> <span class="i">—É—Ç–≤–∏–∫Œª—ç—Ä—ç–Ω</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">td</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="i">span</span> <span class="i">style</span><span class="o">=</span><span class="s">&quot;color:#ff6600;&quot;</span><span class="o">&gt;</span><span class="i">slightly</span> <span class="i">delayed</span>, <span class="i">coming</span> <span class="o">&lt;</span><span class="i">a</span> <span class="i">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com/TeaDrivenDev/status/811208426562945029&quot;</span><span class="o">&gt;</span><span class="i">soon</span><span class="o">&lt;/</span><span class="i">a</span><span class="o">&gt;</span><span class="o">&amp;</span>#<span class="n">8230</span>;<span class="o">&lt;/</span><span class="i">span</span><span class="o">&gt;</span><span class="o">&lt;/</span><span class="i">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">tr</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>We'll read the content of the cells with Active Patterns, because F# programmers <strong>love</strong> Active Patterns.</p>

<p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">One of the happiest moments for an F# programmer is looking at a problem and thinking &amp;quot;Active. F#%ing. Patterns.&amp;quot;</p>&amp;mdash; –¢—ç –¥—Ä—ç–≤—ç—Ç —É—Ç–≤–∏–∫Œª—ç—Ä—ç–Ω (@TeaDrivenDev) <a href="https://twitter.com/TeaDrivenDev/status/728419377662599168">May 6, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>And they actually make things nice and clear in this case, as we'll see.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// HtmlNode.InnerText() returns the visible text of a node, ignoring any &quot;meta&quot; information like</span>
<span class="c">// links, so we can use this to extract both the date and the author&#39;s name.</span>
<span class="k">let</span> (|<span class="i">TextValue</span>|) (<span class="i">n</span> <span class="o">:</span> <span class="i">HtmlNode</span>) <span class="o">=</span> <span class="i">n</span><span class="o">.</span><span class="i">InnerText</span>()<span class="o">.</span><span class="i">Trim</span>()

<span class="c">// If the &lt;td&gt; node&#39;s first descendant is a &lt;span&gt;, this is a delay notice, so there are no</span>
<span class="c">// articles here. Otherwise we&#39;ll assume there will be 1..n links to articles in this cell,</span>
<span class="c">// given in the normal HTML way in &lt;a&gt; tags, from which we&#39;ll need the &quot;href&quot; attribute and the</span>
<span class="c">// InnerText respectively.</span>
<span class="k">let</span> (|<span class="i">Posts</span>|) (<span class="i">n</span> <span class="o">:</span> <span class="i">HtmlNode</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">n</span><span class="o">.</span><span class="i">Descendants</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">Seq</span><span class="o">.</span><span class="i">tryHead</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="i">Some</span> <span class="i">node</span> <span class="k">when</span> <span class="i">node</span><span class="o">.</span><span class="i">Name</span>() <span class="o">=</span> <span class="s">&quot;span&quot;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="i">empty</span>
    | _ <span class="k">-&gt;</span>
        <span class="i">n</span><span class="o">.</span><span class="i">Descendants</span>(<span class="s">&quot;a&quot;</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 11)" onmouseover="showTip(event, 'fs4', 11)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 12)" onmouseover="showTip(event, 'fs7', 12)" class="i">map</span> (<span class="k">fun</span> <span class="i">link</span> <span class="k">-&gt;</span> <span class="i">link</span><span class="o">.</span><span class="i">Attribute</span>(<span class="s">&quot;href&quot;</span>)<span class="o">.</span><span class="i">Value</span>(), <span class="i">link</span><span class="o">.</span><span class="i">InnerText</span>())

<span class="c">// This creates an Entry record with the date and author from the first two columns for each</span>
<span class="c">// article found in the third column. All the non-article table rows are implicitly ignored here</span>
<span class="c">// because there are no link/title tuples returned for them.</span>
<span class="k">let</span> <span class="i">parseRow</span> (<span class="i">row</span> <span class="o">:</span> <span class="i">HtmlNode</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">row</span><span class="o">.</span><span class="i">Descendants</span>(<span class="s">&quot;td&quot;</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 13)" onmouseover="showTip(event, 'fs4', 13)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">toList</span> <span class="k">with</span>
    | [ <span class="i">TextValue</span> <span class="i">date</span>; <span class="i">TextValue</span> <span class="i">name</span>; <span class="i">Posts</span> <span class="i">posts</span> ] <span class="k">-&gt;</span>
        <span class="i">posts</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 15)" onmouseover="showTip(event, 'fs4', 15)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 16)" onmouseover="showTip(event, 'fs7', 16)" class="i">map</span> (<span class="k">fun</span> (<span class="i">url</span>, <span class="i">title</span>) <span class="k">-&gt;</span>
            { <span class="i">Date</span> <span class="o">=</span> <span class="i">date</span><span class="o">.</span><span class="i">Substring</span>(<span class="n">0</span>, <span class="n">6</span>); <span class="i">Author</span> <span class="o">=</span> <span class="i">name</span>; <span class="i">Title</span> <span class="o">=</span> <span class="i">title</span>; <span class="i">Url</span> <span class="o">=</span> <span class="i">url</span> })
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 18)" onmouseover="showTip(event, 'fs6', 18)" class="i">empty</span>

<span class="c">// A few small helper functions to make processing the HTML more readable</span>
<span class="k">let</span> <span class="i">descendantsNamed</span> <span class="i">name</span> (<span class="i">node</span> <span class="o">:</span> <span class="i">HtmlNode</span>) <span class="o">=</span>
    <span class="i">node</span> <span class="o">|&gt;</span> <span class="i">HtmlNode</span><span class="o">.</span><span class="i">descendants</span> <span class="k">false</span> (<span class="k">fun</span> <span class="i">n</span> <span class="k">-&gt;</span> <span class="i">n</span><span class="o">.</span><span class="i">HasName</span> <span class="i">name</span>)

<span class="k">let</span> <span class="i">firstDescendantNamed</span> <span class="i">name</span> <span class="i">node</span> <span class="o">=</span>
    <span class="i">descendantsNamed</span> <span class="i">name</span> <span class="i">node</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 19)" onmouseover="showTip(event, 'fs4', 19)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 20)" onmouseover="showTip(event, 'fs9', 20)" class="i">head</span>

<span class="k">let</span> <span class="i">innerText</span> (<span class="i">node</span> <span class="o">:</span> <span class="i">HtmlNode</span>) <span class="o">=</span> <span class="i">node</span><span class="o">.</span><span class="i">InnerText</span>()

<span class="c">// In order to be able to easily use this script for processing the calendar overview pages for</span>
<span class="c">// different years, we also need to extract the year.</span>
<span class="k">let</span> <span class="i">getYear</span> <span class="i">body</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">title</span> <span class="o">=</span> <span class="i">body</span> <span class="o">|&gt;</span> <span class="i">firstDescendantNamed</span> <span class="s">&quot;article&quot;</span> <span class="o">|&gt;</span> <span class="i">firstDescendantNamed</span> <span class="s">&quot;h1&quot;</span> <span class="o">|&gt;</span> <span class="i">innerText</span>

    <span class="k">let</span> <span class="i">xmatch</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 21)" onmouseover="showTip(event, 'fs10', 21)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 22)" onmouseover="showTip(event, 'fs11', 22)" class="i">Text</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 23)" onmouseover="showTip(event, 'fs12', 23)" class="i">RegularExpressions</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="i">Regex</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="i">Match</span>(<span class="i">title</span>, <span class="s">@&quot;\d{4}$&quot;</span>)
    <span class="i">xmatch</span><span class="o">.</span><span class="i">Captures</span><span class="o">.</span>[<span class="n">0</span>]<span class="o">.</span><span class="i">Value</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="i">int</span>

<span class="c">// This creates the Entry records for the whole HTML page. Note that we use the Page type we&#39;ve</span>
<span class="c">// created  above, but load the HTML file that we specify here, so we can just as well use this to</span>
<span class="c">// parse the page for 2015&#39;s advent calendar.</span>
<span class="k">let</span> <span class="i">getEntries</span> <span class="i">body</span> <span class="o">=</span>
    <span class="i">body</span>
    <span class="o">|&gt;</span> <span class="i">firstDescendantNamed</span> <span class="s">&quot;table&quot;</span>
    <span class="o">|&gt;</span> <span class="i">firstDescendantNamed</span> <span class="s">&quot;tbody&quot;</span>
    <span class="o">|&gt;</span> <span class="i">descendantsNamed</span> <span class="s">&quot;tr&quot;</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 27)" onmouseover="showTip(event, 'fs4', 27)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 28)" onmouseover="showTip(event, 'fs16', 28)" class="i">collect</span> <span class="i">parseRow</span>

<span class="k">let</span> <span class="i">getValues</span> (<span class="i">pageUrl</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 29)" onmouseover="showTip(event, 'fs3', 29)" class="i">string</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="i">body</span> <span class="o">=</span> <span class="i">Page</span><span class="o">.</span><span class="i">Load</span>(<span class="i">pageUrl</span>)<span class="o">.</span><span class="i">Html</span><span class="o">.</span><span class="i">Body</span>()

    <span class="i">getYear</span> <span class="i">body</span>, <span class="i">getEntries</span> <span class="i">body</span>
</code></pre></td>
</tr>
</table>

<p>Let's look what that gets us.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">year</span>, <span class="i">entries</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">year</span>, <span class="i">entries</span> <span class="o">=</span> <span class="i">getValues</span> <span class="i">OverviewUrl</span>

    <span class="i">year</span>, <span class="i">entries</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 30)" onmouseover="showTip(event, 'fs4', 30)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 31)" onmouseover="showTip(event, 'fs8', 31)" class="i">toList</span>
</code></pre></td>
</tr>
</table>

<h3>Building</h3>

<p>Now that we have all the information, we can reassemble it into the RSS feed.</p>

<p>The basic XML for an RSS feed looks like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;</span><span class="i">rss</span> <span class="i">version</span><span class="o">=</span><span class="s">&quot;2.0&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">channel</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">title</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">title</span> <span class="k">to</span> <span class="i">show</span> <span class="k">in</span> <span class="i">RSS</span> <span class="i">readers</span> <span class="o">--&lt;/</span><span class="i">title</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">link</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">address</span> <span class="k">of</span> <span class="i">the</span> <span class="i">site</span> <span class="i">the</span> <span class="i">feed</span> <span class="i">is</span> <span class="k">for</span>, <span class="i">e</span><span class="o">.</span><span class="i">g</span><span class="o">.</span> <span class="i">the</span> <span class="i">home</span> <span class="i">page</span> <span class="k">of</span> <span class="i">a</span> <span class="i">news</span> <span class="i">website</span> <span class="o">--&lt;/</span><span class="i">link</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">description</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">A</span> <span class="i">potentially</span> <span class="i">longer</span> <span class="i">description</span> <span class="o">--&lt;/</span><span class="i">description</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">pubDate</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">original</span> <span class="i">publication</span> <span class="i">date</span> <span class="o">--&lt;/</span><span class="i">pubDate</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">lastBuildDate</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">date</span> <span class="i">the</span> <span class="i">feed</span> <span class="i">was</span> <span class="i">last</span> <span class="i">modified</span> <span class="o">--&lt;/</span><span class="i">lastBuildDate</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">language</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">content</span> <span class="i">language</span>, <span class="k">of</span> <span class="i">course</span> <span class="o">--&lt;/</span><span class="i">language</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="i">channel</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">rss</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>Inside the <code>channel</code> tag, there will be the individual items, each looking like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;</span><span class="i">item</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">title</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">title</span> <span class="k">to</span> <span class="i">be</span> <span class="i">displayed</span> <span class="k">in</span> <span class="i">readers</span> <span class="o">--&lt;/</span><span class="i">title</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">link</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">link</span> <span class="k">to</span> <span class="i">the</span> <span class="i">actual</span> <span class="i">content</span> <span class="o">--&lt;/</span><span class="i">link</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">guid</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">A</span> <span class="i">globally</span> <span class="i">unique</span> <span class="i">ID</span>, <span class="i">apparently</span> <span class="i">needs</span> <span class="k">to</span> <span class="i">be</span> <span class="i">a</span> <span class="i">URL</span> <span class="o">--&lt;/</span><span class="i">guid</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">pubDate</span><span class="o">&gt;</span><span class="o">--</span> <span class="i">The</span> <span class="i">publication</span> <span class="i">date</span> <span class="o">--&lt;/</span><span class="i">pubDate</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">item</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>

<p>We could use format strings here, but as I don't feel like dealing with multiline strings, it's going to be XLINQ.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Xml.Linq&quot;</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs10', 32)" onmouseover="showTip(event, 'fs10', 32)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs10', 33)" onmouseover="showTip(event, 'fs10', 33)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 34)" onmouseover="showTip(event, 'fs17', 34)" class="i">Linq</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs10', 35)" onmouseover="showTip(event, 'fs10', 35)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 36)" onmouseover="showTip(event, 'fs18', 36)" class="i">Xml</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 37)" onmouseover="showTip(event, 'fs19', 37)" class="i">Linq</span>


<span class="k">let</span> <span class="i">xn</span> <span class="i">name</span> <span class="o">=</span> <span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">name</span>

<span class="c">// As we will get the unencoded characters for apostrophes etc. from the HTML, we&#39;ll use this small</span>
<span class="c">// function to make sure we have our text properly encoded for use in XML.</span>
<span class="k">let</span> <span class="i">xmlEncode</span> <span class="i">s</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">node</span> <span class="o">=</span> <span class="i">Xml</span><span class="o">.</span><span class="i">XmlDocument</span>()<span class="o">.</span><span class="i">CreateElement</span> <span class="s">&quot;root&quot;</span>
    <span class="i">node</span><span class="o">.</span><span class="i">InnerText</span> <span class="o">&lt;-</span> <span class="i">s</span>
    <span class="i">node</span><span class="o">.</span><span class="i">InnerXml</span>

<span class="c">// As there are sometimes posts on January 1st of the new year, we need to make sure they get the</span>
<span class="c">// correct publication date as well.</span>
<span class="k">let</span> <span class="i">getEntryYear</span> <span class="i">baseYear</span> (<span class="i">date</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 38)" onmouseover="showTip(event, 'fs3', 38)" class="i">string</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">date</span><span class="o">.</span><span class="i">Split</span>(<span class="s">&#39; &#39;</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs20', 39)" onmouseover="showTip(event, 'fs20', 39)" class="i">Array</span><span class="o">.</span><span class="i">head</span> <span class="k">with</span>
    | <span class="s">&quot;Jan&quot;</span> <span class="k">-&gt;</span> <span class="i">baseYear</span> <span class="o">+</span> <span class="n">1</span>
    | _ <span class="k">-&gt;</span> <span class="i">baseYear</span>


<span class="k">let</span> <span class="i">entryXml</span> <span class="i">baseYear</span> <span class="i">entry</span> <span class="o">=</span>
    <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;item&quot;</span>,
        <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;title&quot;</span>, <span onmouseout="hideTip(event, 'fs21', 40)" onmouseover="showTip(event, 'fs21', 40)" class="i">sprintf</span> <span class="s">&quot;%s | %s | %s&quot;</span> <span class="i">entry</span><span class="o">.</span><span class="i">Date</span> (<span class="i">xmlEncode</span> <span class="i">entry</span><span class="o">.</span><span class="i">Author</span>) (<span class="i">xmlEncode</span> <span class="i">entry</span><span class="o">.</span><span class="i">Title</span>)),
        <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;link&quot;</span>, <span class="i">entry</span><span class="o">.</span><span class="i">Url</span>),
        <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;guid&quot;</span>, <span class="i">entry</span><span class="o">.</span><span class="i">Url</span>),
        <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;pubDate&quot;</span>, (<span onmouseout="hideTip(event, 'fs21', 41)" onmouseover="showTip(event, 'fs21', 41)" class="i">sprintf</span> <span class="s">&quot;%s %i&quot;</span> <span class="i">entry</span><span class="o">.</span><span class="i">Date</span> (<span class="i">getEntryYear</span> <span class="i">baseYear</span> <span class="i">entry</span><span class="o">.</span><span class="i">Date</span>) <span class="o">|&gt;</span> <span class="i">DateTime</span><span class="o">.</span><span class="i">Parse</span>)<span class="o">.</span><span class="i">ToString</span> <span class="s">&quot;r&quot;</span>))


<span class="k">let</span> <span class="i">emptyFeed</span> <span class="i">year</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">xe</span> <span class="o">=</span>
        <span class="k">let</span> <span class="i">date</span> <span class="o">=</span> <span class="i">DateTime</span><span class="o">.</span><span class="i">Now</span><span class="o">.</span><span class="i">ToString</span> <span class="s">&quot;r&quot;</span>

        <span class="k">let</span> <span class="i">title</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 42)" onmouseover="showTip(event, 'fs21', 42)" class="i">sprintf</span> <span class="s">&quot;F# Advent Calendar %i&quot;</span> <span class="i">year</span>

        <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;rss&quot;</span>,
            <span class="i">XAttribute</span>(<span class="i">xn</span> <span class="s">&quot;version&quot;</span>, <span class="s">&quot;2.0&quot;</span>),
            <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;channel&quot;</span>,
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;title&quot;</span>, <span class="i">title</span>),
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;link&quot;</span>, <span class="i">OverviewUrl</span>),
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;description&quot;</span>,  <span class="i">title</span>),
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;pubDate&quot;</span>, <span class="i">date</span>),
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;lastBuildDate&quot;</span>, <span class="i">date</span>),
                <span class="i">XElement</span>(<span class="i">xn</span> <span class="s">&quot;language&quot;</span>, <span class="s">&quot;en&quot;</span>)))

    <span class="i">xe</span>

<span class="k">let</span> <span class="i">addEntries</span> (<span class="i">feed</span> <span class="o">:</span> <span class="i">XElement</span>) (<span class="i">entries</span> <span class="o">:</span> <span class="i">XElement</span> <span onmouseout="hideTip(event, 'fs22', 43)" onmouseover="showTip(event, 'fs22', 43)" class="i">seq</span>) <span class="o">=</span>
    <span class="i">entries</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 44)" onmouseover="showTip(event, 'fs4', 44)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 45)" onmouseover="showTip(event, 'fs23', 45)" class="i">toArray</span>
    <span class="o">|&gt;</span> <span class="i">feed</span><span class="o">.</span><span class="i">Descendants</span>(<span class="i">xn</span> <span class="s">&quot;channel&quot;</span>)<span class="o">.</span><span class="i">First</span>()<span class="o">.</span><span class="i">Add</span>

    <span class="i">feed</span>

<span class="k">let</span> <span class="i">createFeed</span> <span class="i">url</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">year</span>, <span class="i">entries</span> <span class="o">=</span> <span class="i">getValues</span> <span class="i">url</span>

    <span class="i">year</span>,
    <span class="i">entries</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 46)" onmouseover="showTip(event, 'fs4', 46)" class="i">Seq</span><span class="o">.</span><span class="i">rev</span> <span class="c">// put the latest entry first in the feed</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 47)" onmouseover="showTip(event, 'fs4', 47)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 48)" onmouseover="showTip(event, 'fs7', 48)" class="i">map</span> (<span class="i">entryXml</span> <span class="i">year</span>)
    <span class="o">|&gt;</span> <span class="i">addEntries</span> (<span class="i">emptyFeed</span> <span class="i">year</span>)
</code></pre></td>
</tr>
</table>

<h3>Writing</h3>

<p>That was all pretty straightforward. Now that we can create the feed XML, we only need to write the actual XML file to disk.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs10', 49)" onmouseover="showTip(event, 'fs10', 49)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 50)" onmouseover="showTip(event, 'fs24', 50)" class="i">IO</span>

<span class="k">let</span> <span class="i">repositoryDir</span> <span class="o">=</span> <span class="s">@&quot;D:\Development\Projects\Active\TeaDrivenDev.github.io&quot;</span>

<span class="k">let</span> <span class="i">rssFile</span> <span class="o">=</span> <span class="s">@&quot;public\fsadvent%i.rss&quot;</span>

<span class="k">let</span> <span class="i">writeFeed</span> <span class="i">fileName</span> <span class="i">feed</span> <span class="o">=</span>
    <span class="i">File</span><span class="o">.</span><span class="i">WriteAllText</span>(<span class="i">fileName</span>, <span onmouseout="hideTip(event, 'fs3', 51)" onmouseover="showTip(event, 'fs3', 51)" class="i">string</span> <span class="i">feed</span>)

<span class="i">OverviewUrl</span>
<span class="o">|&gt;</span> <span class="i">createFeed</span>
<span class="o">|&gt;</span> (<span class="k">fun</span> (<span class="i">year</span>, <span class="i">feed</span>) <span class="k">-&gt;</span> <span class="i">writeFeed</span> (<span class="i">Path</span><span class="o">.</span><span class="i">Combine</span>(<span class="i">repositoryDir</span>, <span onmouseout="hideTip(event, 'fs21', 52)" onmouseover="showTip(event, 'fs21', 52)" class="i">sprintf</span> (<span onmouseout="hideTip(event, 'fs25', 53)" onmouseover="showTip(event, 'fs25', 53)" class="i">Printf</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 54)" onmouseover="showTip(event, 'fs26', 54)" class="i">StringFormat</span><span class="o">&lt;</span>_<span class="o">&gt;</span> <span class="i">rssFile</span>) <span class="i">year</span>)) <span class="i">feed</span>)
</code></pre></td>
</tr>
</table>

<p>Now that we have created the RSS file(s), the only thing left is publishing it. Depending on where we do that, it might require different steps, but for the typical things like FTP upload or publishing via Git, FAKE makes that easy anyway. I'm putting the feed on my GitHub Pages site, so we need to commit it to Git. We use Paket to add FAKE to our project, then reference it in our script, and add the calls to stage and commit the RSS file(s). We could also push to GitHub from here, but I prefer to do that by hand.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">@&quot;..\packages\FAKE\tools\FakeLib.dll&quot;</span>

<span class="k">open</span> <span class="i">Fake</span><span class="o">.</span><span class="i">Git</span><span class="o">.</span><span class="i">CommandHelper</span>

<span class="i">gitCommand</span> <span class="i">repositoryDir</span> <span class="s">&quot;add *.rss&quot;</span>
<span class="i">gitCommand</span> <span class="i">repositoryDir</span> <span class="s">&quot;commit -m \&quot;Updated F# advent calendar RSS feed\&quot;&quot;</span>
</code></pre></td>
</tr>
</table>

<h3>Not Dea.... Done Yet</h3>

<p>That's it, essentially. For the (in this case short remaining) duration of the F# Advent Calendar, we run this once a day or so and publish the updated feed to GitHub.
This script will process the overview pages for 2015 and 2016; the one for 2014 is a little different and would need special treatment.</p>

<p>There is one very annoying problem that we are going to have with the feed specifically if (as with me) Feedly is being used as the RSS aggregator. When subscribing to a feed, Feedly only pulls first 10 items (which in our case are the latest ones, since we've reversed the order). If we're adding feed with over 50 entries at once now, we'd lose most of the articles. There is a workaround, though, but it requires control over publishing the feed: <em>Updating</em> a feed in Feedly appears to have no limit on the number of items. That means if we initially create the feed with only 10 items, publish it and add it to Feedly, and only <em>then</em> generate the rest of the items and publish again. So for the first time creating the feed, we need a slightly modified version of the <code>createFeed</code> function:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">createFeed&#39;</span> <span class="i">url</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">year</span>, <span class="i">entries</span> <span class="o">=</span> <span class="i">getValues</span> <span class="i">url</span>

    <span class="i">entries</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 55)" onmouseover="showTip(event, 'fs4', 55)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 56)" onmouseover="showTip(event, 'fs27', 56)" class="i">take</span> <span class="n">10</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 57)" onmouseover="showTip(event, 'fs4', 57)" class="i">Seq</span><span class="o">.</span><span class="i">rev</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 58)" onmouseover="showTip(event, 'fs4', 58)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 59)" onmouseover="showTip(event, 'fs7', 59)" class="i">map</span> (<span class="i">entryXml</span> <span class="i">year</span>)
    <span class="o">|&gt;</span> <span class="i">addEntries</span> (<span class="i">emptyFeed</span> <span class="i">year</span>)
</code></pre></td>
</tr>
</table>

<p>For all subsequent generation runs, we switch back to the original function without the <code>Seq.truncate</code> call.</p>

<p>There's still one issue with that solution that I haven't been able to fix, though: Feedly will only give those first 10 entries their actual <code>pubDate</code> values from the RSS file, and date all others as they arrive. That means that in the case of 2016, we'll get correctly dated entries until about the beginning of December, and after that, there will be 40+ articles with the date when we first publish the full feed. But as we have the date in the title for each entry, and the specific dates generally shouldn't have any relevance for the articles' content, that's probably something we can live with.</p>

<h3>Possible improvements</h3>

<ul>
<li>Make this a webservice as mentioned at the beginning, to get rid of the manual updating</li>
<li>Get the actual publication dates and descriptions/content for the individual posts. That would require following the link to each post, getting the RSS feed for the respective blog, finding the entry for the post and more or less copying the XML from there.</li>
<li>Probably other things I'm currently not thinking of</li>
</ul>

<h3>End</h3>

<p>The 2016 feed is at <a href="https://teadrivendev.github.io/public/fsadvent2016.rss"><a href="https://teadrivendev.github.io/public/fsadvent2016.rss">https://teadrivendev.github.io/public/fsadvent2016.rss</a></a>; I will update it for the few remaining days of the 2016 calendar. So in case you find this useful (and don't use Feedly), you can just use that.</p>

<p>I have no last words.</p>


<div class="tip" id="fs1">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs2">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs3">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs4">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs5">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs6">val empty&lt;&#39;T&gt; : seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.empty</div>
<div class="tip" id="fs7">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs8">val toList : source:seq&lt;&#39;T&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toList</div>
<div class="tip" id="fs9">val head : source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.head</div>
<div class="tip" id="fs10">namespace System</div>
<div class="tip" id="fs11">namespace System.Text</div>
<div class="tip" id="fs12">namespace System.Text.RegularExpressions</div>
<div class="tip" id="fs13">Multiple items<br />type Regex =<br />&#160;&#160;new : pattern:string -&gt; Regex + 1 overload<br />&#160;&#160;member GetGroupNames : unit -&gt; string[]<br />&#160;&#160;member GetGroupNumbers : unit -&gt; int[]<br />&#160;&#160;member GroupNameFromNumber : i:int -&gt; string<br />&#160;&#160;member GroupNumberFromName : name:string -&gt; int<br />&#160;&#160;member IsMatch : input:string -&gt; bool + 1 overload<br />&#160;&#160;member Match : input:string -&gt; Match + 2 overloads<br />&#160;&#160;member Matches : input:string -&gt; MatchCollection + 1 overload<br />&#160;&#160;member Options : RegexOptions<br />&#160;&#160;member Replace : input:string * replacement:string -&gt; string + 5 overloads<br />&#160;&#160;...<br /><br />Full name: System.Text.RegularExpressions.Regex<br /><br />--------------------<br />System.Text.RegularExpressions.Regex(pattern: string) : unit<br />System.Text.RegularExpressions.Regex(pattern: string, options: System.Text.RegularExpressions.RegexOptions) : unit</div>
<div class="tip" id="fs14">System.Text.RegularExpressions.Regex.Match(input: string, pattern: string) : System.Text.RegularExpressions.Match<br />System.Text.RegularExpressions.Regex.Match(input: string, pattern: string, options: System.Text.RegularExpressions.RegexOptions) : System.Text.RegularExpressions.Match</div>
<div class="tip" id="fs15">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs16">val collect : mapping:(&#39;T -&gt; #seq&lt;&#39;U&gt;) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.collect</div>
<div class="tip" id="fs17">namespace System.Linq</div>
<div class="tip" id="fs18">namespace System.Xml</div>
<div class="tip" id="fs19">namespace Microsoft.FSharp.Linq</div>
<div class="tip" id="fs20">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs21">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs22">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = System.Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs23">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs24">namespace System.IO</div>
<div class="tip" id="fs25">module Printf<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs26">type StringFormat&lt;&#39;T,&#39;Result&gt; = Format&lt;&#39;T,unit,string,&#39;Result&gt;<br /><br />Full name: Microsoft.FSharp.Core.PrintfModule.StringFormat&lt;_,_&gt;</div>
<div class="tip" id="fs27">val take : count:int -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.take</div>
